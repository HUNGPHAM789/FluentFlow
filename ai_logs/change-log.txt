=== LOG ENTRY: 2024-05-22 10:00:00 ===
ACTION TYPE: bug_fix
LOG_TAG: grammar-level-logic
FILES AFFECTED:
- services/content.ts
DESCRIPTION:
Fix type mismatch for indexOf in generateGrammarExercise where answer can be string or string[].
CODE DIFF:
- correctIndex: drill.options.indexOf(drill.answer),
+ correctIndex: (drill.options && typeof drill.answer === 'string') ? drill.options.indexOf(drill.answer) : 0,
===========================================

=== LOG ENTRY: 2025-05-23 11:45 ===
ACTION TYPE: refactor
LOG_TAG: grammar-progress
FILES AFFECTED:
src/hooks/useLearningSession.ts
App.tsx
DESCRIPTION:
Refactored GrammarGuruView to use CoreLearningEngine via useLearningSession for grammar sessions.
Removed local drillIndex and drillResults state from GrammarGuruView.
handleCheckAnswer now delegates to engine.submit().
finalizeLesson now accepts explicit correct/total counts from engine stats.
UI flow (alerts, progress bar, completion screen) preserved.
CODE DIFF:
const [drillIndex, setDrillIndex] = useState(0);
const { session, currentItem, start, submit } = useLearningSession({ type: 'GRAMMAR', lessonId: selectedLesson?.id });
const isCorrect = evaluateDrillAnswer(currentDrill, userAnswer);
const { result, isComplete, stats } = submit(userAnswer);
===========================================

=== LOG ENTRY: 2025-05-23 12:05 ===
ACTION TYPE: logic_update
LOG_TAG: grammar-progress
FILES AFFECTED:
types.ts
utils/storage.ts
src/engine/coreLearningEngine.ts
src/hooks/useLearningSession.ts
App.tsx
DESCRIPTION:
Connected CoreLearningEngine grammar sessions to user XP and streak in storage.
Added lastActive to UserProfile type.
Added addUserXp and updateStreakOnActivity to storage utils.
Added commitSession to CoreLearningEngine to trigger these updates using session stats.
Exposed commit in useLearningSession hook.
Called commit() in GrammarGuruView.finalizeLesson to sync XP/streak and update local user state.
CODE DIFF:
export interface UserProfile { ... lastActive?: string; }
export const addUserXp = (amount: number) => { ... }
export const updateStreakOnActivity = () => { ... }
static commitSession(session): UserProfile | null { ... }
const updatedUser = commit(); if (updatedUser) onUpdateUser(updatedUser);
===========================================

=== LOG ENTRY: 2025-05-23 12:30 ===
ACTION TYPE: ui_update
LOG_TAG: grammar-ui
FILES AFFECTED:
- src/components/ProfileAndAchievementsView.tsx
- App.tsx
- types.ts
DESCRIPTION:
Created unified Profile & Achievements view that displays user XP, streak, level, grammar progress by CEFR level, and badges, and wired it into AppView navigation without changing engine or storage logic.
CODE DIFF:
+ <ProfileAndAchievementsView user={user} ... />
+ case AppView.PROFILE_ACHIEVEMENTS: ...
===========================================

=== LOG ENTRY: 2025-05-23 13:00 ===
ACTION TYPE: logic_update
LOG_TAG: storage
FILES AFFECTED:
- types.ts
- utils/storage.ts
- src/engine/coreLearningEngine.ts
DESCRIPTION:
Added per-drill performance tracking for grammar (correct/incorrect counts and lastAnswerAt) via new DrillPerformance type, DRILL_PERFORMANCE_KEY storage map, and recordDrillResult called from CoreLearningEngine.submitAnswer. No UI changes yet.
CODE DIFF:
+ export interface DrillPerformance { ... }
+ export const recordDrillResult = (drillId, isCorrect) => { ... }
+ recordDrillResult(currentItem.id, isCorrect);
===========================================

=== LOG ENTRY: 2025-05-23 13:30 ===
ACTION TYPE: logic_update
LOG_TAG: grammar-progress
FILES AFFECTED:
- utils/storage.ts
- src/engine/coreLearningEngine.ts
DESCRIPTION:
Added review queue selection for grammar based on DrillPerformance via getWeakDrillIds and CoreLearningEngine.getGrammarReviewItems/startGrammarReviewSession. No UI changes yet.
CODE DIFF:
+ export const getWeakDrillIds = (options) => { ... }
+ static

=== LOG ENTRY: 2025-05-23 14:00 ===
ACTION TYPE: refactor
LOG_TAG: navigation
FILES AFFECTED:
- App.tsx
- src/components/DashboardView.tsx
- src/components/GrammarGuruView.tsx
- src/navigation/viewRegistry.ts
DESCRIPTION:
Introduced a minimal viewRegistry mapping AppView to components and refactored App.tsx to render core views through the registry while preserving existing routing behavior and props. Extracted DashboardView and GrammarGuruView to separate files to enable this.
CODE DIFF:
+ export const viewRegistry = { [AppView.DASHBOARD]: DashboardView, ... };
+ const ActiveView = viewRegistry[view];
===========================================

=== LOG ENTRY: 2025-05-23 14:15 ===
ACTION TYPE: refactor
LOG_TAG: file-structure
FILES AFFECTED:
- navigation/viewRegistry.ts
- components/*.tsx
- engine/coreLearningEngine.ts
- hooks/useLearningSession.ts
DESCRIPTION:
Flattened file structure by moving new components, hooks, and engine files from src/ to root directory to match existing project structure and fix relative module import errors.
CODE DIFF:
N/A (File moves)
===========================================

=== LOG ENTRY: 2025-05-23 14:30 ===
ACTION TYPE: refactor
LOG_TAG: navigation
FILES AFFECTED:
App.tsx
ai_logs/change-log.txt
DESCRIPTION:
Centralized AppView-based rendering into a renderCoreView helper inside App.tsx to act as a basic navigation registry, replacing the inline if/switch logic and removing dependency on external viewRegistry.
CODE DIFF:
+ const renderCoreView = (view, user, lang, setView, handleUpdateUser) => { switch(view) { ... } }
+ if (user) { const coreView = renderCoreView(...); if (coreView) return coreView; }
===========================================

=== LOG ENTRY: 2025-05-23 14:45 ===
ACTION TYPE: ui_update
LOG_TAG: grammar-ui
FILES AFFECTED:
src/components/ProfileAndAchievementsView.tsx
DESCRIPTION:
Added a merged mastery/review summary line on Profile & Achievements, combining overall grammar mastery percent, weak drills count, and today's reviewed drills using existing stats helpers without changing behavior.
CODE DIFF:
+ const overallMasteryPercent = useMemo(() => { ... }, [grammarStats]);
+ <p>Mastery: {overallMasteryPercent}% • Needs Review: {weakDrillCount} • Reviewed Today: {reviewedToday}</p>
===========================================